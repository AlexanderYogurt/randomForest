30c30
< void F77_SUB(rrand)(double *r) { *r = unif_rand(); }
---
> /* void F77_SUB(rrand)(double *r) { *r = unif_rand(); } */
32,38c32,40
< void rf(double *x, int *ncol, int *nrow, int *cl, int *ncl, int *cat, 
<         int *maxcat, int *addcl, int *ntree, int *nvar, int *ipi, double
<         *pi, int *nodesize, int *imp, int *iprox, int *noutlier, 
<         double *outlier, int *outcl, int *counttr, double *prox, 
< 	double *imprt, int *trace, int *ndbigtree, int *nodestatus, 
< 	int *bestvar, int *treemap, int *nodeclass, double *xbestsplit, 
< 	double *pid, int *savef)
---
> void classRF(double *x, int *ncol, int *nrow, int *cl, int *ncl, int *cat, 
> 	     int *maxcat, int *addcl, int *ntree, int *nvar, int *ipi, 
> 	     double *pi, int *nodesize, int *imp, int *iprox, 
> 	     int *noutlier, double *outlier, int *outcl, int *counttr, 
> 	     double *prox, double *imprt, int *trace, int *ndbigtree, 
> 	     int *nodestatus, int *bestvar, int *treemap, 
> 	     int *nodeclass, double *xbestsplit, double *pid, 
> 	     int *testdat, double *xts, int *clts, int *nts, 
> 	     double *countts, int *outclts, int *labelts)
79c81
<   int jb, j, n, m, mr, k, kt, itwo, arrayindex;
---
>   int jb, j, n, m, mr, k, kt, itwo;
84,85c86,87
<     *jtr, *nc, *msum, *jet, *idmove, *jvr, *countimp,
<     *at, *a, *b, *cbestsplit, *mind;
---
>     *jtr, *nc, *msum, *idmove, *jvr, *countimp,
>     *at, *a, *b, *cbestsplit, *mind, *jts;
87c89
<   double errtr, errc;
---
>   double errtr, errts, errc;
92c94
<     *tout, *tdx, *sm, *p, *q, *xts, *iw;
---
>     *tout, *tdx, *sm, *p, *q, *iw;
101c103
<   ntest = 1; 
---
>   ntest = *nts; 
118d119
<   xts =        (double *) S_alloc(mdim*ntest, sizeof(double)); 
153a155
>   jts =           (int *) S_alloc(ntest, sizeof(int)); 
156d157
<   jet =           (int *) S_alloc(ntest, sizeof(int));
173a175,179
>   if(*testdat == 1) {
>     for (n = 0; n < nclass; ++n) {
>       for (k = 0; k < ntest; ++k) countts[n + k*nclass] = 0.0;
>     }
>   }
178c184
<   errtr = 0.0;
---
>   errtr = 0.0;  errts = 0.0;
201,206c207,210
<     arrayindex = (*savef == 1) ? jb * nrnodes : 0;
< 
<     F77_CALL(zerv)(nodestatus + arrayindex, &nrnodes);
<     F77_CALL(zerm)(treemap + 2*arrayindex, &itwo, &nrnodes);
<     F77_CALL(zervr)(xbestsplit + arrayindex, &nrnodes);
<     F77_CALL(zerv)(nodeclass + arrayindex, &nrnodes);
---
>     F77_CALL(zerv)(nodestatus, &nrnodes);
>     F77_CALL(zerm)(treemap, &itwo, &nrnodes);
>     F77_CALL(zervr)(xbestsplit, &nrnodes);
>     F77_CALL(zerv)(nodeclass, &nrnodes);
224,226c228,230
< 			treemap + 2*arrayindex, 
< 			bestvar + arrayindex, bestsplit, bestsplitnext, tgini,
< 			nodestatus + arrayindex, nodepop, nodestart, classpop,
---
> 			treemap, 
> 			bestvar, bestsplit, bestsplitnext, tgini,
> 			nodestatus, nodepop, nodestart, classpop,
229c233
< 			nodeclass + arrayindex, ndbigtree + jb, win, wr, wc,
---
> 			nodeclass, ndbigtree + jb, win, wr, wc,
232,234c236,248
<     F77_CALL(xtranslate)(x, &mdim, &nrnodes, &nsample, bestvar + arrayindex, 
< 			 bestsplit, bestsplitnext, xbestsplit + arrayindex,
< 			 nodestatus + arrayindex, cat, ndbigtree + jb); 
---
>     F77_CALL(xtranslate)(x, &mdim, &nrnodes, &nsample, bestvar, 
> 			 bestsplit, bestsplitnext, xbestsplit,
> 			 nodestatus, cat, ndbigtree + jb); 
>     /*  Get test set error */
>     if(*testdat == 1) {
>       F77_CALL(testreebag)(xts, &ntest, &mdim, treemap, nodestatus, 
> 			   xbestsplit, cbestsplit, bestvar, nodeclass,
> 			   &nrnodes, ndbigtree + jb, cat, &nclass,
> 			   jts,nodexts,maxcat);
>       F77_CALL(comptserr)(countts, jts, clts, outclts, &ntest, &nclass,
> 			    &errts, pid, labelts);
>     }
> 
236,239c250,252
<     F77_CALL(testreebag)(x, &nsample, &mdim, treemap + 2*arrayindex, 
< 			 nodestatus + arrayindex, xbestsplit + arrayindex, 
< 			 cbestsplit, bestvar + arrayindex, 
< 			 nodeclass + arrayindex, &nrnodes, ndbigtree + jb, 
---
>     F77_CALL(testreebag)(x, &nsample, &mdim, treemap, nodestatus, 
> 			 xbestsplit, cbestsplit, bestvar, nodeclass, 
> 			 &nrnodes, ndbigtree + jb, 
254,255c267,272
<       if(*trace < jbt)
< 	Rprintf("%4i: Out-of-bag error rate=%5.2f%%\n", jb+1, 100.0*errtr);
---
>       if(*trace < jbt) {
> 	Rprintf("%4i: OOB error rate=%5.2f%%\t", jb+1, 100.0*errtr);
> 	if(*labelts == 1) 
> 	  Rprintf("Test set error rate=%5.2f%%", 100.0*errts);
> 	Rprintf("\n");
>       }
262,268c279,285
<         if(nodestatus[kt + arrayindex] != -1) {
< 	  assert(kt + arrayindex < jbt * nrnodes);
< 	  assert(kt + arrayindex >= 0);
< 	  assert(bestvar[kt + arrayindex] - 1 < mdim);
< 	  assert(bestvar[kt + arrayindex] - 1 >= 0);
< 	  iv[bestvar[kt + arrayindex] - 1] = 1;
< 	  msum[bestvar[kt + arrayindex] - 1] ++;
---
>         if(nodestatus[kt] != -1) {
> 	  assert(kt < jbt * nrnodes);
> 	  assert(kt >= 0);
> 	  assert(bestvar[kt] - 1 < mdim);
> 	  assert(bestvar[kt] - 1 >= 0);
> 	  iv[bestvar[kt] - 1] = 1;
> 	  msum[bestvar[kt] - 1] ++;
274,278c291,293
< 	  F77_CALL(testreebag)(x, &nsample, &mdim, treemap + 2*arrayindex, 
< 			       nodestatus + arrayindex,
< 			       xbestsplit + arrayindex, cbestsplit, 
< 			       bestvar + arrayindex, nodeclass + arrayindex, 
< 			       &nrnodes, ndbigtree + jb, cat,
---
> 	  F77_CALL(testreebag)(x, &nsample, &mdim, treemap, nodestatus,
> 			       xbestsplit, cbestsplit, bestvar, 
> 			       nodeclass, &nrnodes, ndbigtree + jb, cat,
314c329
<       
---
>   
